<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard v7.0 - UYEH TECH (Complete System)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Link to external CSS files -->
<style>
    /* ========== ADMIN DASHBOARD v7.0 - CSS PART 1 OF 2 ========== */
/* Base Styles, Sidebar, Topbar, Layout, Cards, Tables */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #00ff88;
    --primary-dark: #00b359;
    --dark: #0a0a0a;
    --dark-light: #1a1a1a;
    --gray: #9ca3af;
    --gray-light: #d1d5db;
    --success: #00ff88;
    --error: #ff4444;
    --warning: #ffa500;
    --info: #0096ff;
}

body {
    font-family: 'Montserrat', sans-serif;
    background: var(--dark);
    color: #fff;
    overflow-x: hidden;
}

/* ========== SIDEBAR ========== */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 280px;
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.95), rgba(10, 10, 10, 0.95));
    border-right: 1px solid rgba(0, 255, 136, 0.2);
    padding: 30px 0;
    z-index: 1000;
    overflow-y: auto;
    transition: transform 0.3s;
}

.sidebar-header {
    padding: 0 30px 30px;
    border-bottom: 1px solid rgba(0, 255, 136, 0.2);
}

.logo {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
}

.logo-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
}

.logo-text {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    color: var(--primary);
}

.admin-info {
    padding: 20px 30px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.admin-avatar {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.admin-details h4 {
    font-size: 0.95rem;
    margin-bottom: 3px;
}

.admin-details p {
    font-size: 0.8rem;
    color: var(--gray);
}

.nav-menu {
    padding: 20px 0;
}

.nav-item {
    padding: 15px 30px;
    display: flex;
    align-items: center;
    gap: 15px;
    color: var(--gray-light);
    cursor: pointer;
    transition: all 0.3s;
    border-left: 3px solid transparent;
    position: relative;
}

.nav-item:hover {
    background: rgba(0, 255, 136, 0.05);
    color: var(--primary);
    border-left-color: var(--primary);
}

.nav-item.active {
    background: rgba(0, 255, 136, 0.1);
    color: var(--primary);
    border-left-color: var(--primary);
}

.nav-item i {
    font-size: 1.2rem;
    width: 25px;
}

.nav-badge {
    position: absolute;
    right: 20px;
    background: var(--error);
    color: #fff;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 600;
}

/* ========== MAIN CONTENT ========== */
.main-content {
    margin-left: 280px;
    min-height: 100vh;
}

/* ========== TOPBAR ========== */
.topbar {
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.95), rgba(10, 10, 10, 0.95));
    border-bottom: 1px solid rgba(0, 255, 136, 0.2);
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}

.search-bar {
    flex: 1;
    max-width: 500px;
    position: relative;
}

.search-bar input {
    width: 100%;
    padding: 12px 20px 12px 45px;
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.95rem;
}

.search-bar i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
}

.topbar-actions {
    display: flex;
    align-items: center;
    gap: 20px;
}

.topbar-btn {
    width: 45px;
    height: 45px;
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
}

.topbar-btn:hover {
    background: rgba(0, 255, 136, 0.1);
    border-color: var(--primary);
}

.badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--error);
    color: #fff;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.logout-btn {
    padding: 10px 20px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border: none;
    border-radius: 8px;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
}

/* ========== CONTENT AREA ========== */
.content-area {
    padding: 40px;
}

.page-header {
    margin-bottom: 30px;
}

.page-title {
    font-family: 'Playfair Display', serif;
    font-size: 2.2rem;
    color: var(--primary);
    margin-bottom: 10px;
}

.page-subtitle {
    color: var(--gray);
    font-size: 1rem;
}

/* ========== STATS CARDS ========== */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.stat-card {
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.95), rgba(10, 10, 10, 0.95));
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 15px;
    padding: 25px;
    transition: all 0.3s;
    cursor: pointer;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
    box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.stat-icon {
    width: 50px;
    height: 50px;
    background: rgba(0, 255, 136, 0.1);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--primary);
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #fff;
    margin-bottom: 5px;
}

.stat-label {
    color: var(--gray);
    font-size: 0.9rem;
}

.stat-change {
    font-size: 0.85rem;
    margin-top: 10px;
}

.stat-change.positive {
    color: var(--success);
}

.stat-change.negative {
    color: var(--error);
}

/* ========== TABLES ========== */
.table-container {
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.95), rgba(10, 10, 10, 0.95));
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.table-title {
    font-size: 1.3rem;
    font-weight: 600;
}

.table-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    color: #fff;
}

.btn-secondary {
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.3);
    color: var(--primary);
}

.btn-danger {
    background: linear-gradient(135deg, #cc0000, var(--error));
    color: #fff;
}

.btn-warning {
    background: linear-gradient(135deg, #cc8400, var(--warning));
    color: #fff;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    border-bottom: 1px solid rgba(0, 255, 136, 0.2);
}

th {
    padding: 15px;
    text-align: left;
    color: var(--primary);
    font-weight: 600;
    font-size: 0.9rem;
}

td {
    padding: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

tr:hover {
    background: rgba(0, 255, 136, 0.05);
}

.status-badge {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
}

.status-completed { background: rgba(0, 255, 136, 0.2); color: var(--success); }
.status-pending { background: rgba(255, 165, 0, 0.2); color: var(--warning); }
.status-failed { background: rgba(255, 68, 68, 0.2); color: var(--error); }
.status-active { background: rgba(0, 255, 136, 0.2); color: var(--success); }
.status-inactive { background: rgba(255, 68, 68, 0.2); color: var(--error); }
.status-published { background: rgba(0, 255, 136, 0.2); color: var(--success); }
.status-draft { background: rgba(255, 165, 0, 0.2); color: var(--warning); }
.status-archived { background: rgba(156, 163, 175, 0.2); color: var(--gray); }
.status-open { background: rgba(0, 150, 255, 0.2); color: var(--info); }
.status-assigned { background: rgba(255, 165, 0, 0.2); color: var(--warning); }
.status-in-progress { background: rgba(0, 150, 255, 0.2); color: var(--info); }
.status-resolved { background: rgba(0, 255, 136, 0.2); color: var(--success); }
.status-closed { background: rgba(156, 163, 175, 0.2); color: var(--gray); }
.status-online { background: rgba(0, 255, 136, 0.2); color: var(--success); }
.status-offline { background: rgba(156, 163, 175, 0.2); color: var(--gray); }
.status-busy { background: rgba(255, 68, 68, 0.2); color: var(--error); }
.status-away { background: rgba(255, 165, 0, 0.2); color: var(--warning); }

.action-btns {
    display: flex;
    gap: 8px;
}

.action-btn {
    width: 35px;
    height: 35px;
    border: 1px solid rgba(0, 255, 136, 0.3);
    background: rgba(0, 255, 136, 0.05);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    color: #fff;
}

.action-btn:hover {
    background: rgba(0, 255, 136, 0.1);
    border-color: var(--primary);
}

.action-btn.danger:hover {
    background: rgba(255, 68, 68, 0.1);
    border-color: var(--error);
}

.action-btn.warning:hover {
    background: rgba(255, 165, 0, 0.1);
    border-color: var(--warning);
}

/* ========== AGENT SPECIFIC STYLES ========== */
.agent-card {
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.95), rgba(10, 10, 10, 0.95));
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.agent-card:hover {
    border-color: var(--primary);
    transform: translateX(5px);
}

.agent-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.agent-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.agent-avatar {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
}

.agent-details h3 {
    font-size: 1.1rem;
    margin-bottom: 5px;
}

.agent-details p {
    font-size: 0.85rem;
    color: var(--gray);
}

.agent-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.agent-stat-item {
    text-align: center;
    padding: 10px;
    background: rgba(0, 255, 136, 0.05);
    border-radius: 8px;
}

.agent-stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
}

.agent-stat-label {
    font-size: 0.75rem;
    color: var(--gray);
    margin-top: 5px;
}

/* ========== CHAT STYLES ========== */
.chat-card {
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
    cursor: pointer;
}

.chat-card:hover {
    border-color: var(--primary);
    transform: translateX(5px);
}

.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.chat-customer {
    display: flex;
    align-items: center;
    gap: 12px;
}

.chat-avatar {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
}

.chat-info h4 {
    font-size: 0.95rem;
    margin-bottom: 3px;
}

.chat-info p {
    font-size: 0.8rem;
    color: var(--gray);
}

.priority-badge {
    padding: 3px 10px;
    border-radius: 15px;
    font-size: 0.7rem;
    font-weight: 600;
}

.priority-low { background: rgba(0, 150, 255, 0.2); color: var(--info); }
.priority-medium { background: rgba(255, 165, 0, 0.2); color: var(--warning); }
.priority-high { background: rgba(255, 68, 68, 0.2); color: var(--error); }
.priority-urgent { background: rgba(200, 0, 0, 0.3); color: #ff6666; }

.chat-messages {
    max-height: 400px;
    overflow-y: auto;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    margin-bottom: 15px;
}

.chat-message {
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    max-width: 80%;
}

.chat-message.customer {
    background: rgba(0, 150, 255, 0.1);
    border: 1px solid rgba(0, 150, 255, 0.3);
    margin-right: auto;
}

.chat-message.agent {
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.3);
    margin-left: auto;
}

.chat-message.system {
    background: rgba(156, 163, 175, 0.1);
    border: 1px solid rgba(156, 163, 175, 0.3);
    margin: 0 auto;
    text-align: center;
    font-size: 0.85rem;
    color: var(--gray);
}

.message-sender {
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--primary);
}

.message-text {
    font-size: 0.9rem;
    line-height: 1.5;
}

.message-time {
    font-size: 0.75rem;
    color: var(--gray);
    margin-top: 5px;
}

/* ========== DOWNLOAD LINK INDICATOR ========== */
.download-indicator {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 10px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 15px;
    font-size: 0.75rem;
    color: var(--primary);
}

.download-indicator i {
    font-size: 0.9rem;
}

.no-download {
    color: var(--error);
    background: rgba(255, 68, 68, 0.1);
    border-color: rgba(255, 68, 68, 0.3);
}

/* ========== HIDE CLASS ========== */
.hidden {
    display: none !important;
}

/* ========== PAGINATION ========== */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 20px;
}

.pagination button {
    padding: 8px 16px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 8px;
    color: var(--primary);
    cursor: pointer;
    transition: all 0.3s;
}

.pagination button:hover:not(:disabled) {
    background: rgba(0, 255, 136, 0.2);
}

.pagination button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination .page-info {
    color: var(--gray);
    font-size: 0.9rem;
}
/* ========== ADMIN DASHBOARD v7.0 - CSS PART 2 OF 2 ========== */
/* Modals, Forms, Loading, Notifications, Alerts, Responsive */

/* ========== MODAL ========== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 2000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: linear-gradient(135deg, rgba(15, 15, 15, 0.98), rgba(10, 10, 10, 0.98));
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 20px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary);
}

.close-modal {
    width: 35px;
    height: 35px;
    background: rgba(255, 68, 68, 0.1);
    border: 1px solid rgba(255, 68, 68, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    color: #fff;
}

.close-modal:hover {
    background: rgba(255, 68, 68, 0.2);
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    color: var(--primary);
    font-weight: 600;
    font-size: 0.9rem;
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    padding: 12px 15px;
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: 0.95rem;
    font-family: 'Montserrat', sans-serif;
}

.form-textarea {
    min-height: 120px;
    resize: vertical;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(0, 255, 136, 0.1);
}

/* ========== DOWNLOAD LINK SECTION ========== */
.download-link-section {
    background: rgba(0, 255, 136, 0.05);
    border: 2px solid rgba(0, 255, 136, 0.3);
    border-radius: 12px;
    padding: 15px;
    position: relative;
}

.download-link-section::before {
    content: "üîí Payment Protected";
    position: absolute;
    top: -12px;
    right: 15px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
    color: #fff;
}

.download-link-section .form-label {
    color: var(--primary);
    font-size: 1rem;
    margin-bottom: 10px;
}

.download-link-section .form-input {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(0, 255, 136, 0.4);
}

.download-link-section .form-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
}

/* ========== LOADING ========== */
.loading {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(0, 255, 136, 0.2);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ========== NOTIFICATIONS ========== */
.notification {
    position: fixed;
    top: 30px;
    right: 30px;
    padding: 18px 25px;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    z-index: 10000;
    animation: slideIn 0.3s ease;
    min-width: 300px;
}

@keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.notification.success { background: linear-gradient(135deg, #00b359, #00ff88); color: #fff; }
.notification.error { background: linear-gradient(135deg, #ff4444, #ff6666); color: #fff; }
.notification.info { background: linear-gradient(135deg, #0096ff, #00d4ff); color: #fff; }
.notification.warning { background: linear-gradient(135deg, #cc8400, #ffa500); color: #fff; }

/* ========== ALERT BOX ========== */
.alert-box {
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.alert-box i {
    font-size: 1.3rem;
}

.alert-info {
    background: rgba(0, 150, 255, 0.1);
    border: 1px solid rgba(0, 150, 255, 0.3);
    color: var(--info);
}

.alert-success {
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.3);
    color: var(--success);
}

.alert-warning {
    background: rgba(255, 165, 0, 0.1);
    border: 1px solid rgba(255, 165, 0, 0.3);
    color: var(--warning);
}

.alert-error {
    background: rgba(255, 68, 68, 0.1);
    border: 1px solid rgba(255, 68, 68, 0.3);
    color: var(--error);
}

/* ========== EMPTY STATE ========== */
.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.3;
}

.empty-state h3 {
    color: var(--primary);
    margin-bottom: 10px;
}

.empty-state p {
    color: var(--gray);
    margin-bottom: 20px;
}

/* ========== COPY BUTTON ========== */
.copy-btn {
    padding: 6px 12px;
    background: rgba(0, 255, 136, 0.1);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 6px;
    color: var(--primary);
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.85rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.copy-btn:hover {
    background: rgba(0, 255, 136, 0.2);
    transform: scale(1.05);
}

.copy-btn i {
    font-size: 0.9rem;
}

/* ========== FILTER SECTION ========== */
.filter-section {
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.filter-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.filter-label {
    font-size: 0.85rem;
    color: var(--gray);
    font-weight: 600;
}

/* ========== BADGE VARIATIONS ========== */
.badge-new {
    background: linear-gradient(135deg, #00b359, #00ff88);
    color: #fff;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: 8px;
}

.badge-hot {
    background: linear-gradient(135deg, #ff4444, #ff6666);
    color: #fff;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: 8px;
}

/* ========== QUICK ACTIONS BAR ========== */
.quick-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.quick-action-btn {
    padding: 12px 20px;
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: 10px;
    color: var(--primary);
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
}

.quick-action-btn:hover {
    background: rgba(0, 255, 136, 0.1);
    transform: translateY(-2px);
}

.quick-action-btn i {
    font-size: 1.2rem;
}

/* ========== INFO CARDS ========== */
.info-card {
    background: linear-gradient(135deg, rgba(0, 150, 255, 0.05), rgba(0, 150, 255, 0.1));
    border: 1px solid rgba(0, 150, 255, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.info-card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.info-card-icon {
    width: 45px;
    height: 45px;
    background: rgba(0, 150, 255, 0.2);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    color: var(--info);
}

.info-card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--info);
}

.info-card-content {
    color: var(--gray-light);
    line-height: 1.6;
}

/* ========== SUCCESS CARDS ========== */
.success-card {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 255, 136, 0.1));
    border: 2px solid rgba(0, 255, 136, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

/* ========== WARNING CARDS ========== */
.warning-card {
    background: linear-gradient(135deg, rgba(255, 165, 0, 0.05), rgba(255, 165, 0, 0.1));
    border: 2px solid rgba(255, 165, 0, 0.3);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

/* ========== ACTIVITY FEED ========== */
.activity-item {
    display: flex;
    gap: 15px;
    padding: 15px;
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 10px;
    margin-bottom: 10px;
    transition: all 0.3s;
}

.activity-item:hover {
    background: rgba(0, 255, 136, 0.1);
    border-color: var(--primary);
    transform: translateX(5px);
}

.activity-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 5px;
}

.activity-description {
    font-size: 0.85rem;
    color: var(--gray);
    margin-bottom: 5px;
}

.activity-time {
    font-size: 0.75rem;
    color: var(--gray);
}

/* ========== METRICS GRID ========== */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.metric-item {
    background: rgba(0, 255, 136, 0.05);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s;
}

.metric-item:hover {
    border-color: var(--primary);
    transform: translateY(-3px);
}

.metric-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 5px;
}

.metric-label {
    font-size: 0.85rem;
    color: var(--gray);
}

/* ========== SCROLLBAR STYLES ========== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
}

::-webkit-scrollbar-thumb {
    background: rgba(0, 255, 136, 0.3);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 255, 136, 0.5);
}

/* ========== RESPONSIVE ========== */
@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%);
    }
    
    .sidebar.active {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
    }
}

@media (max-width: 768px) {
    .content-area {
        padding: 20px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .topbar {
        padding: 15px 20px;
    }
    
    .search-bar {
        max-width: 100%;
    }
    
    .table-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    table {
        font-size: 0.85rem;
    }
    
    th, td {
        padding: 10px;
    }
    
    .modal-content {
        padding: 25px;
        width: 95%;
    }
    
    .notification {
        right: 10px;
        left: 10px;
        min-width: auto;
    }
    
    .agent-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .page-title {
        font-size: 1.6rem;
    }
    
    .stat-value {
        font-size: 1.5rem;
    }
    
    .action-btns {
        flex-wrap: wrap;
    }
    
    .table-actions {
        width: 100%;
    }
    
    .table-actions .form-input,
    .table-actions .form-select {
        width: 100%;
    }
    
    .quick-actions {
        flex-direction: column;
    }
    
    .quick-action-btn {
        width: 100%;
        justify-content: center;
    }
    
    .filter-grid {
        grid-template-columns: 1fr;
    }
    
    .agent-stats {
        grid-template-columns: 1fr;
    }
    
    .metrics-grid {
        grid-template-columns: 1fr;
    }
}

/* ========== PRINT STYLES ========== */
@media print {
    .sidebar,
    .topbar,
    .action-btns,
    .btn,
    .modal {
        display: none !important;
    }
    
    .main-content {
        margin-left: 0;
    }
    
    .table-container {
        border: 1px solid #000;
    }
}
</style>
</head>
<body>
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">UT</div>
                <div class="logo-text">UYEH TECH</div>
            </div>
        </div>

        <div class="admin-info">
            <div class="admin-avatar">üë®‚Äçüíº</div>
            <div class="admin-details">
                <h4 id="adminName">Admin</h4>
                <p id="adminEmail">admin@uyehtech.com</p>
            </div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item active" data-page="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" data-page="analytics">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </div>
            <div class="nav-item" data-page="users">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </div>
            
            <!-- NEW: Agent Management -->
            <div class="nav-item" data-page="agents">
                <i class="fas fa-headset"></i>
                <span>Agent Management</span>
                <span class="nav-badge" id="pendingAgentsBadge" style="display: none;">0</span>
            </div>
            
            <!-- NEW: Chat Management -->
            <div class="nav-item" data-page="chats">
                <i class="fas fa-comments"></i>
                <span>Chat & Support</span>
                <span class="nav-badge" id="openChatsBadge" style="display: none;">0</span>
            </div>
            
            <div class="nav-item" data-page="orders">
                <i class="fas fa-shopping-cart"></i>
                <span>Orders</span>
            </div>
            <div class="nav-item" data-page="products">
                <i class="fas fa-box"></i>
                <span>Products</span>
            </div>
            <div class="nav-item" data-page="downloads">
                <i class="fas fa-download"></i>
                <span>Downloads</span>
            </div>
            <div class="nav-item" data-page="coupons">
                <i class="fas fa-ticket-alt"></i>
                <span>Coupons</span>
            </div>
            <div class="nav-item" data-page="blog">
                <i class="fas fa-blog"></i>
                <span>Blog</span>
            </div>
            <div class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- TOPBAR -->
        <div class="topbar">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search..." id="globalSearch">
            </div>

            <div class="topbar-actions">
                <div class="topbar-btn" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i>
                </div>
                <div class="topbar-btn" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notificationCount">0</span>
                </div>
                <button class="logout-btn" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- CONTENT AREA -->
        <div class="content-area">
            <div id="dashboardPage" class="page-content"></div>
            <div id="analyticsPage" class="page-content hidden"></div>
            <div id="usersPage" class="page-content hidden"></div>
            <div id="agentsPage" class="page-content hidden"></div>
            <div id="chatsPage" class="page-content hidden"></div>
            <div id="ordersPage" class="page-content hidden"></div>
            <div id="productsPage" class="page-content hidden"></div>
            <div id="downloadsPage" class="page-content hidden"></div>
            <div id="couponsPage" class="page-content hidden"></div>
            <div id="blogPage" class="page-content hidden"></div>
            <div id="settingsPage" class="page-content hidden"></div>
        </div>
    </main>

    <!-- PROMOTE USER TO AGENT MODAL -->
    <div id="promoteAgentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Promote User to Agent</h2>
                <button class="close-modal" onclick="closeModal('promoteAgentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="promoteAgentForm" onsubmit="handlePromoteAgent(event)">
                <input type="hidden" name="userId" id="promoteUserId">
                
                <div class="alert-box alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>This user will be able to handle customer support chats</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">User</label>
                    <input type="text" class="form-input" id="promoteUserName" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Department *</label>
                    <select class="form-select" name="department" required>
                        <option value="General">General Support</option>
                        <option value="Sales">Sales</option>
                        <option value="Support">Technical Support</option>
                        <option value="Technical">Technical</option>
                        <option value="Billing">Billing</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Maximum Concurrent Chats *</label>
                    <input type="number" class="form-input" name="maxChats" required min="1" max="20" value="5">
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Promote to Agent
                </button>
            </form>
        </div>
    </div>

    <!-- AGENT SETTINGS MODAL -->
    <div id="agentSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Agent Settings</h2>
                <button class="close-modal" onclick="closeModal('agentSettingsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="agentSettingsForm" onsubmit="handleUpdateAgentSettings(event)">
                <input type="hidden" name="agentId" id="agentSettingsId">
                
                <div class="form-group">
                    <label class="form-label">Agent Name</label>
                    <input type="text" class="form-input" id="agentSettingsName" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <select class="form-select" name="department" id="agentSettingsDepartment">
                        <option value="General">General Support</option>
                        <option value="Sales">Sales</option>
                        <option value="Support">Technical Support</option>
                        <option value="Technical">Technical</option>
                        <option value="Billing">Billing</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Maximum Concurrent Chats</label>
                    <input type="number" class="form-input" name="maxChats" id="agentSettingsMaxChats" min="1" max="20">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" name="status" id="agentSettingsStatus">
                        <option value="online">Online</option>
                        <option value="offline">Offline</option>
                        <option value="busy">Busy</option>
                        <option value="away">Away</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Update Settings
                </button>
            </form>
        </div>
    </div>

    <!-- ASSIGN CHAT MODAL -->
    <div id="assignChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Assign Chat to Agent</h2>
                <button class="close-modal" onclick="closeModal('assignChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="assignChatForm" onsubmit="handleAssignChat(event)">
                <input type="hidden" name="chatId" id="assignChatId">
                
                <div class="form-group">
                    <label class="form-label">Chat Details</label>
                    <div style="padding: 12px; background: rgba(0,255,136,0.05); border-radius: 8px; margin-bottom: 15px;">
                        <div id="assignChatDetails"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Agent *</label>
                    <select class="form-select" name="agentId" id="assignAgentSelect" required>
                        <option value="">Loading agents...</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-check"></i> Assign Chat
                </button>
            </form>
        </div>
    </div>

    <!-- VIEW CHAT MODAL -->
    <div id="viewChatModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Chat Conversation</h2>
                <button class="close-modal" onclick="closeModal('viewChatModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="viewChatContent">
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner"></div>
                    <p style="color: var(--gray); margin-top: 15px;">Loading chat...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- CREATE PRODUCT MODAL -->
    <div id="createProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Product</h2>
                <button class="close-modal" onclick="closeModal('createProductModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createProductForm" onsubmit="handleCreateProduct(event)">
                <div class="form-group">
                    <label class="form-label">Product Title *</label>
                    <input type="text" class="form-input" name="title" required placeholder="Enter product name">
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-textarea" name="description" required placeholder="Product description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <input type="text" class="form-input" name="category" required placeholder="e.g., Templates, Courses, Software">
                </div>
                <div class="form-group">
                    <label class="form-label">Price *</label>
                    <input type="number" class="form-input" name="price" required min="0" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Compare Price</label>
                    <input type="number" class="form-input" name="comparePrice" min="0" step="0.01" placeholder="Original price">
                </div>
                
                <div class="form-group download-link-section">
                    <label class="form-label">
                        <i class="fas fa-download"></i> Download Link *
                    </label>
                    <input type="url" class="form-input" name="downloadLink" required placeholder="https://drive.google.com/...">
                    <small style="color: var(--gray); display: block; margin-top: 5px;">
                        üî• Accessible to customers after payment
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">File Size</label>
                    <input type="text" class="form-input" name="fileSize" placeholder="e.g., 5.2 MB">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Version</label>
                    <input type="text" class="form-input" name="version" placeholder="e.g., 1.0">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Product Icon</label>
                    <input type="text" class="form-input" name="icon" placeholder="Icon emoji">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="isActive" checked> Active
                    </label>
                    <label class="form-label" style="margin-left: 20px;">
                        <input type="checkbox" name="isFeatured"> Featured
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-plus"></i> Create Product
                </button>
            </form>
        </div>
    </div>

    <!-- EDIT PRODUCT MODAL -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Product</h2>
                <button class="close-modal" onclick="closeModal('editProductModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editProductForm" onsubmit="handleUpdateProduct(event)">
                <input type="hidden" name="productId" id="editProductId">
                
                <div class="form-group">
                    <label class="form-label">Product Title *</label>
                    <input type="text" class="form-input" name="title" id="editProductTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-textarea" name="description" id="editProductDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <input type="text" class="form-input" name="category" id="editProductCategory" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Price *</label>
                    <input type="number" class="form-input" name="price" id="editProductPrice" required min="0" step="0.01">
                </div>
                
                <div class="form-group download-link-section">
                    <label class="form-label">
                        <i class="fas fa-download"></i> Download Link *
                    </label>
                    <input type="url" class="form-input" name="downloadLink" id="editProductDownloadLink" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">File Size</label>
                    <input type="text" class="form-input" name="fileSize" id="editProductFileSize">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="isActive" id="editProductIsActive"> Active
                    </label>
                    <label class="form-label" style="margin-left: 20px;">
                        <input type="checkbox" name="isFeatured" id="editProductIsFeatured"> Featured
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Update Product
                </button>
            </form>
        </div>
    </div>

    <!-- CREATE COUPON MODAL -->
    <div id="createCouponModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Coupon</h2>
                <button class="close-modal" onclick="closeModal('createCouponModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createCouponForm" onsubmit="handleCreateCoupon(event)">
                <div class="form-group">
                    <label class="form-label">Coupon Code *</label>
                    <input type="text" class="form-input" name="code" required placeholder="e.g., SAVE20">
                </div>
                <div class="form-group">
                    <label class="form-label">Discount Value *</label>
                    <input type="number" class="form-input" name="discount" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">Discount Type *</label>
                    <select class="form-select" name="type" required>
                        <option value="percentage">Percentage (%)</option>
                        <option value="fixed">Fixed Amount ($)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Usage Limit</label>
                    <input type="number" class="form-input" name="usageLimit" min="1" placeholder="Leave empty for unlimited">
                </div>
                <div class="form-group">
                    <label class="form-label">Minimum Purchase Amount</label>
                    <input type="number" class="form-input" name="minPurchaseAmount" min="0" step="0.01" value="0">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Coupon</button>
            </form>
        </div>
    </div>

    <!-- CREATE BLOG POST MODAL -->
    <div id="createBlogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Blog Post</h2>
                <button class="close-modal" onclick="closeModal('createBlogModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createBlogForm" onsubmit="handleCreateBlogPost(event)">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" class="form-input" name="title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Excerpt *</label>
                    <textarea class="form-textarea" name="excerpt" required maxlength="300"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Content *</label>
                    <textarea class="form-textarea" name="content" required style="min-height: 200px;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select class="form-select" name="category" required>
                        <option value="Technology">Technology</option>
                        <option value="Business">Business</option>
                        <option value="Tutorial">Tutorial</option>
                        <option value="News">News</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Status *</label>
                    <select class="form-select" name="status" required>
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Post</button>
            </form>
        </div>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="loading">
        <div class="spinner"></div>
    </div>

    <!-- Link to external JavaScript files -->
    <script>
        // ========== ADMIN DASHBOARD v7.0 - JAVASCRIPT PART 1 OF 5 ==========
// Core Setup, Authentication & Navigation

const API_URL = 'https://uyehtechbackend.onrender.com';
const ADMIN_EMAIL = 'uyehtech@gmail.com';
let currentPage = 'dashboard';
let adminToken = '';
let adminUser = {};

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', async function() {
    console.log('‚úÖ Admin Dashboard v7.0 Initialized');
    
    adminToken = localStorage.getItem('admin_token');
    const userStr = localStorage.getItem('admin_user');
    
    if (!adminToken) {
        window.location.href = 'admin-login.html';
        return;
    }
    
    if (userStr) {
        adminUser = JSON.parse(userStr);
        document.getElementById('adminName').textContent = adminUser.name || 'Admin';
        document.getElementById('adminEmail').textContent = adminUser.email || '';
    }
    
    await verifyAdminToken();
    initializeNavigation();
    loadDashboardData();
    updateNotificationBadges();
});

// ========== AUTHENTICATION ==========
async function verifyAdminToken() {
    try {
        const response = await fetch(`${API_URL}/api/auth/admin/verify`, {
            headers: {
                'Authorization': `Bearer ${adminToken}`,
                'Content-Type': 'application/json'
            }
        });

        const data = await response.json();

        if (!data.success || !data.isAdmin) {
            localStorage.removeItem('admin_token');
            localStorage.removeItem('admin_user');
            window.location.href = 'admin-login.html';
        }
    } catch (error) {
        console.error('Token verification failed:', error);
        localStorage.removeItem('admin_token');
        localStorage.removeItem('admin_user');
        window.location.href = 'admin-login.html';
    }
}

function handleLogout() {
    if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('admin_token');
        localStorage.removeItem('admin_user');
        window.location.href = 'admin-login.html';
    }
}

// ========== NAVIGATION ==========
function initializeNavigation() {
    const navItems = document.querySelectorAll('.nav-item');
    
    navItems.forEach(item => {
        item.addEventListener('click', () => {
            const page = item.getAttribute('data-page');
            navigateTo(page);
        });
    });
}

function navigateTo(page) {
    currentPage = page;
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === page) {
            item.classList.add('active');
        }
    });
    
    document.querySelectorAll('.page-content').forEach(p => {
        p.classList.add('hidden');
    });
    
    const pageElement = document.getElementById(`${page}Page`);
    if (pageElement) {
        pageElement.classList.remove('hidden');
    }
    
    switch(page) {
        case 'dashboard': loadDashboardData(); break;
        case 'analytics': loadAnalyticsData(); break;
        case 'users': loadUsersData(); break;
        case 'agents': loadAgentsData(); break;
        case 'chats': loadChatsData(); break;
        case 'orders': loadOrdersData(); break;
        case 'products': loadProductsData(); break;
        case 'downloads': loadDownloadsData(); break;
        case 'coupons': loadCouponsData(); break;
        case 'blog': loadBlogData(); break;
        case 'settings': loadSettingsData(); break;
    }
}

// ========== UPDATE NOTIFICATION BADGES ==========
async function updateNotificationBadges() {
    try {
        const response = await fetch(`${API_URL}/api/admin/dashboard`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const { overview } = data.dashboard;
            document.getElementById('notificationCount').textContent = overview.totalOrders || 0;
            
            if (overview.openChats > 0) {
                const badge = document.getElementById('openChatsBadge');
                badge.textContent = overview.openChats;
                badge.style.display = 'inline';
            }
        }
    } catch (error) {
        console.error('Badge update error:', error);
    }
}

// ========== UTILITY FUNCTIONS ==========
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

function showNotification(message, type = 'info') {
    const existing = document.querySelectorAll('.notification');
    existing.forEach(n => n.remove());

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => notification.remove(), 4000);
}

function showNotifications() {
    showNotification('No new notifications', 'info');
}

function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) modal.classList.add('active');
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) modal.classList.remove('active');
}

function updatePagination(containerId, pagination, callback) {
    const container = document.getElementById(containerId);
    if (!container || !pagination) return;
    
    const { page, pages, total } = pagination;
    
    container.innerHTML = `
        <button ${page <= 1 ? 'disabled' : ''} onclick="(${callback})(${page - 1})">
            <i class="fas fa-chevron-left"></i> Previous
        </button>
        <span class="page-info">Page ${page} of ${pages} (${total} total)</span>
        <button ${page >= pages ? 'disabled' : ''} onclick="(${callback})(${page + 1})">
            Next <i class="fas fa-chevron-right"></i>
        </button>
    `;
}

console.log('‚úÖ Part 1/5 loaded: Core, Auth, Navigation, Utilities');
// ========== ADMIN DASHBOARD v7.0 - JAVASCRIPT PART 2 OF 5 ==========
// Dashboard & Analytics Pages

// ========== DASHBOARD ==========
async function loadDashboardData() {
    const dashboardPage = document.getElementById('dashboardPage');
    
    dashboardPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">Welcome back! Here's your overview</p>
        </div>
        <div class="stats-grid" id="dashboardStats"></div>
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Recent Orders</h3>
                <button class="btn btn-secondary" onclick="navigateTo('orders')">View All</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="recentOrdersTable">
                    <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    `;
    
    try {
        showLoading();
        
        const response = await fetch(`${API_URL}/api/admin/dashboard`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const { overview, recentStats, recentOrdersList } = data.dashboard;
            
            document.getElementById('dashboardStats').innerHTML = `
                <div class="stat-card" onclick="navigateTo('users')">
                    <div class="stat-header"><div class="stat-icon">üë•</div></div>
                    <div class="stat-value">${overview.totalUsers}</div>
                    <div class="stat-label">Total Users</div>
                    <div class="stat-change positive">+${recentStats.newUsers} this week</div>
                </div>
                <div class="stat-card" onclick="navigateTo('orders')">
                    <div class="stat-header"><div class="stat-icon">üì¶</div></div>
                    <div class="stat-value">${overview.totalOrders}</div>
                    <div class="stat-label">Total Orders</div>
                    <div class="stat-change positive">+${recentStats.recentOrders} this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><div class="stat-icon">üí∞</div></div>
                    <div class="stat-value">$${overview.totalRevenue.toFixed(2)}</div>
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-change positive">+$${recentStats.recentRevenue.toFixed(2)} this week</div>
                </div>
                <div class="stat-card" onclick="navigateTo('products')">
                    <div class="stat-header"><div class="stat-icon">üõçÔ∏è</div></div>
                    <div class="stat-value">${overview.totalProducts}</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card" onclick="navigateTo('chats')">
                    <div class="stat-header"><div class="stat-icon">üí¨</div></div>
                    <div class="stat-value">${overview.totalChats || 0}</div>
                    <div class="stat-label">Total Chats</div>
                    <div class="stat-change ${overview.openChats > 0 ? 'positive' : ''}">${overview.openChats || 0} open</div>
                </div>
                <div class="stat-card" onclick="navigateTo('agents')">
                    <div class="stat-header"><div class="stat-icon">üë®‚Äçüíº</div></div>
                    <div class="stat-value">${overview.activeAgents || 0}</div>
                    <div class="stat-label">Active Agents</div>
                </div>
            `;
            
            const tbody = document.getElementById('recentOrdersTable');
            if (!recentOrdersList || recentOrdersList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No orders found</td></tr>';
            } else {
                tbody.innerHTML = recentOrdersList.map(order => `
                    <tr onclick="navigateTo('orders')" style="cursor: pointer;">
                        <td>${order.orderReference}</td>
                        <td>${order.customerInfo.name}</td>
                        <td>$${order.total.toFixed(2)}</td>
                        <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                        <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                    </tr>
                `).join('');
            }
            
            updateNotificationBadges();
        }
        
        hideLoading();
    } catch (error) {
        console.error('Dashboard error:', error);
        showNotification('Failed to load dashboard data', 'error');
        hideLoading();
    }
}

// ========== ANALYTICS ==========
async function loadAnalyticsData(period = '7d') {
    const analyticsPage = document.getElementById('analyticsPage');
    
    analyticsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Analytics</h1>
            <p class="page-subtitle">Track your business performance</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Period</label>
                    <select class="form-select" onchange="loadAnalyticsData(this.value)">
                        <option value="7d" ${period === '7d' ? 'selected' : ''}>Last 7 Days</option>
                        <option value="30d" ${period === '30d' ? 'selected' : ''}>Last 30 Days</option>
                        <option value="90d" ${period === '90d' ? 'selected' : ''}>Last 90 Days</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="metrics-grid">
            <div class="metric-item">
                <div class="metric-value" id="analyticsRevenue">$0</div>
                <div class="metric-label">Total Revenue</div>
            </div>
            <div class="metric-item">
                <div class="metric-value" id="analyticsOrders">0</div>
                <div class="metric-label">Total Orders</div>
            </div>
            <div class="metric-item">
                <div class="metric-value" id="analyticsNewUsers">0</div>
                <div class="metric-label">New Users</div>
            </div>
            <div class="metric-item">
                <div class="metric-value" id="analyticsChats">0</div>
                <div class="metric-label">New Chats</div>
            </div>
            <div class="metric-item">
                <div class="metric-value" id="analyticsConversion">0%</div>
                <div class="metric-label">Conversion Rate</div>
            </div>
        </div>
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Top Products</h3>
            </div>
            <table>
                <thead>
                    <tr><th>Product</th><th>Sales</th><th>Revenue</th></tr>
                </thead>
                <tbody id="topProductsTable">
                    <tr><td colspan="3" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    `;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/analytics?period=${period}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const { dailyStats, userGrowth, productPerformance, chatTrends } = data.analytics;
            
            const totalRevenue = dailyStats.reduce((sum, day) => sum + day.revenue, 0);
            const totalOrders = dailyStats.reduce((sum, day) => sum + day.orders, 0);
            const completedOrders = dailyStats.reduce((sum, day) => sum + day.completed, 0);
            const newUsers = userGrowth.reduce((sum, day) => sum + day.count, 0);
            const newChats = chatTrends ? chatTrends.reduce((sum, day) => sum + day.count, 0) : 0;
            const conversionRate = totalOrders > 0 ? ((completedOrders / totalOrders) * 100).toFixed(1) : 0;
            
            document.getElementById('analyticsRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            document.getElementById('analyticsOrders').textContent = totalOrders;
            document.getElementById('analyticsNewUsers').textContent = newUsers;
            document.getElementById('analyticsChats').textContent = newChats;
            document.getElementById('analyticsConversion').textContent = `${conversionRate}%`;
            
            const topProductsTable = document.getElementById('topProductsTable');
            if (productPerformance.length > 0) {
                topProductsTable.innerHTML = productPerformance.map(product => `
                    <tr>
                        <td>${product._id}</td>
                        <td>${product.sales}</td>
                        <td>$${product.revenue.toFixed(2)}</td>
                    </tr>
                `).join('');
            } else {
                topProductsTable.innerHTML = '<tr><td colspan="3" style="text-align: center;">No data</td></tr>';
            }
        }
    } catch (error) {
        console.error('Analytics error:', error);
        showNotification('Failed to load analytics', 'error');
    }
}

console.log('‚úÖ Part 2/5 loaded: Dashboard & Analytics');
// ========== ADMIN DASHBOARD v7.0 - JAVASCRIPT PART 3 OF 5 ==========
// Users & Agent Management

// ========== USERS MANAGEMENT ==========
async function loadUsersData(page = 1, search = '', status = 'all', role = 'all') {
    const usersPage = document.getElementById('usersPage');
    
    usersPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">User Management</h1>
            <p class="page-subtitle">Manage all registered users</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Search</label>
                    <input type="text" class="form-input" placeholder="Search..." id="userSearchInput" value="${search}">
                </div>
                <div class="filter-item">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="userStatusFilter">
                        <option value="all" ${status === 'all' ? 'selected' : ''}>All</option>
                        <option value="active" ${status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="banned" ${status === 'banned' ? 'selected' : ''}>Banned</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">Role</label>
                    <select class="form-select" id="userRoleFilter">
                        <option value="all" ${role === 'all' ? 'selected' : ''}>All</option>
                        <option value="user" ${role === 'user' ? 'selected' : ''}>Users</option>
                        <option value="agent" ${role === 'agent' ? 'selected' : ''}>Agents</option>
                        <option value="admin" ${role === 'admin' ? 'selected' : ''}>Admins</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Name</th><th>Email</th><th>Orders</th><th>Chats</th><th>Spent</th><th>Status</th><th>Actions</th></tr>
                </thead>
                <tbody id="usersTable">
                    <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
            <div class="pagination" id="usersPagination"></div>
        </div>
    `;
    
    document.getElementById('userSearchInput').addEventListener('input', (e) => {
        loadUsersData(1, e.target.value, document.getElementById('userStatusFilter').value, document.getElementById('userRoleFilter').value);
    });
    
    document.getElementById('userStatusFilter').addEventListener('change', (e) => {
        loadUsersData(1, document.getElementById('userSearchInput').value, e.target.value, document.getElementById('userRoleFilter').value);
    });
    
    document.getElementById('userRoleFilter').addEventListener('change', (e) => {
        loadUsersData(1, document.getElementById('userSearchInput').value, document.getElementById('userStatusFilter').value, e.target.value);
    });
    
    try {
        const response = await fetch(`${API_URL}/api/admin/users?page=${page}&limit=20&search=${search}&status=${status}&role=${role}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const tbody = document.getElementById('usersTable');
            
            if (!data.users || data.users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No users found</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.users.map(user => `
                <tr>
                    <td>${user.fullName}</td>
                    <td>${user.email}</td>
                    <td>${user.orderCount || 0}</td>
                    <td>${user.chatCount || 0}</td>
                    <td>$${(user.totalSpent || 0).toFixed(2)}</td>
                    <td>
                        <span class="status-badge ${user.isBanned ? 'status-inactive' : 'status-active'}">
                            ${user.isBanned ? 'Banned' : 'Active'}
                        </span>
                        ${user.isAdmin ? '<span class="status-badge status-completed">Admin</span>' : ''}
                        ${user.isAgent ? '<span class="status-badge status-in-progress">Agent</span>' : ''}
                    </td>
                    <td>
                        <div class="action-btns">
                            ${!user.isAdmin ? `
                                ${!user.isAgent ? `
                                    <button class="action-btn" onclick="openPromoteAgentModal('${user._id}', '${user.fullName}')" title="Promote to Agent">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                ` : ''}
                                <button class="action-btn" onclick="toggleBanUser('${user._id}', ${!user.isBanned})" title="${user.isBanned ? 'Unban' : 'Ban'}">
                                    <i class="fas fa-${user.isBanned ? 'check' : 'ban'}"></i>
                                </button>
                                <button class="action-btn danger" onclick="deleteUser('${user._id}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : '<span style="color: var(--gray);">Admin</span>'}
                        </div>
                    </td>
                </tr>
            `).join('');
            
            if (data.pagination) {
                updatePagination('usersPagination', data.pagination, (p) => loadUsersData(p, search, status, role));
            }
        }
    } catch (error) {
        console.error('Users error:', error);
        showNotification('Failed to load users', 'error');
    }
}

async function toggleBanUser(userId, shouldBan) {
    const action = shouldBan ? 'ban' : 'unban';
    const reason = shouldBan ? prompt('Enter ban reason:') : '';
    
    if (shouldBan && !reason) return;
    if (!confirm(`${action} this user?`)) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/users/${userId}/ban`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ isBanned: shouldBan, banReason: reason })
        });

        const data = await response.json();
        if (data.success) {
            showNotification(`User ${action}ned`, 'success');
            loadUsersData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification(`Failed to ${action} user`, 'error');
    }
}

async function deleteUser(userId) {
    if (!confirm('Delete this user?')) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/users/${userId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        if (data.success) {
            showNotification('User deleted', 'success');
            loadUsersData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to delete user', 'error');
    }
}

// ========== AGENT MANAGEMENT ==========
async function loadAgentsData() {
    const agentsPage = document.getElementById('agentsPage');
    
    agentsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Agent Management</h1>
            <p class="page-subtitle">Manage customer support agents</p>
        </div>
        <div class="info-card">
            <div class="info-card-header">
                <div class="info-card-icon">‚ÑπÔ∏è</div>
                <div class="info-card-title">About Agents</div>
            </div>
            <div class="info-card-content">
                Agents handle customer support chats. Promote users to agents from the Users page.
            </div>
        </div>
        <div id="agentsContainer">
            <div style="text-align: center; padding: 40px;">
                <div class="spinner"></div>
                <p style="color: var(--gray); margin-top: 15px;">Loading...</p>
            </div>
        </div>
    `;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/agents`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        const container = document.getElementById('agentsContainer');

        if (data.success) {
            if (data.agents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë®‚Äçüíº</div>
                        <h3>No Agents Yet</h3>
                        <p>Promote users to agents from the Users page</p>
                        <button class="btn btn-primary" onclick="navigateTo('users')">
                            <i class="fas fa-users"></i> Go to Users
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = data.agents.map(agent => `
                    <div class="agent-card">
                        <div class="agent-header">
                            <div class="agent-info">
                                <div class="agent-avatar">üë®‚Äçüíº</div>
                                <div class="agent-details">
                                    <h3>${agent.name}</h3>
                                    <p>${agent.email}</p>
                                    <p style="margin-top: 5px;">
                                        <span class="status-badge status-${agent.status}">${agent.status}</span>
                                        <span style="color: var(--gray); margin-left: 10px;">${agent.department}</span>
                                    </p>
                                </div>
                            </div>
                            <div class="action-btns">
                                <button class="action-btn" onclick="openAgentSettingsModal('${agent.id}')" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <button class="action-btn danger" onclick="demoteAgent('${agent.id}')" title="Remove">
                                    <i class="fas fa-user-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="agent-stats">
                            <div class="agent-stat-item">
                                <div class="agent-stat-value">${agent.activeChats}</div>
                                <div class="agent-stat-label">Active</div>
                            </div>
                            <div class="agent-stat-item">
                                <div class="agent-stat-value">${agent.totalChats}</div>
                                <div class="agent-stat-label">Total</div>
                            </div>
                            <div class="agent-stat-item">
                                <div class="agent-stat-value">${agent.resolvedChats}</div>
                                <div class="agent-stat-label">Resolved</div>
                            </div>
                            <div class="agent-stat-item">
                                <div class="agent-stat-value">${agent.rating.toFixed(1)}‚≠ê</div>
                                <div class="agent-stat-label">Rating</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }
    } catch (error) {
        console.error('Agents error:', error);
        showNotification('Failed to load agents', 'error');
    }
}

function openPromoteAgentModal(userId, userName) {
    document.getElementById('promoteUserId').value = userId;
    document.getElementById('promoteUserName').value = userName;
    openModal('promoteAgentModal');
}

async function handlePromoteAgent(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/admin/users/${formData.get('userId')}/promote-agent`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                department: formData.get('department'),
                maxChats: parseInt(formData.get('maxChats'))
            })
        });

        const data = await response.json();
        if (data.success) {
            showNotification('‚úÖ User promoted to agent!', 'success');
            closeModal('promoteAgentModal');
            event.target.reset();
            loadUsersData();
            loadAgentsData();
        } else {
            showNotification(data.message, 'error');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to promote user', 'error');
        hideLoading();
    }
}

async function demoteAgent(agentId) {
    if (!confirm('Remove agent role?')) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/users/${agentId}/demote-agent`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Agent demoted', 'success');
            loadAgentsData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to demote agent', 'error');
    }
}

async function openAgentSettingsModal(agentId) {
    try {
        const response = await fetch(`${API_URL}/api/admin/agents`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });
        const data = await response.json();
        
        if (data.success) {
            const agent = data.agents.find(a => a.id === agentId);
            if (agent) {
                document.getElementById('agentSettingsId').value = agent.id;
                document.getElementById('agentSettingsName').value = agent.name;
                document.getElementById('agentSettingsDepartment').value = agent.department;
                document.getElementById('agentSettingsMaxChats').value = agent.maxChats;
                document.getElementById('agentSettingsStatus').value = agent.status;
                openModal('agentSettingsModal');
            }
        }
    } catch (error) {
        showNotification('Failed to load agent settings', 'error');
    }
}

async function handleUpdateAgentSettings(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/admin/agents/${formData.get('agentId')}`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                department: formData.get('department'),
                maxChats: parseInt(formData.get('maxChats')),
                status: formData.get('status')
            })
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Agent settings updated', 'success');
            closeModal('agentSettingsModal');
            loadAgentsData();
        } else {
            showNotification(data.message, 'error');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to update settings', 'error');
        hideLoading();
    }
}

console.log('‚úÖ Part 3/5 loaded: Users & Agent Management');
// ========== ADMIN DASHBOARD v7.0 - JAVASCRIPT PART 4 OF 5 ==========
// Chat Management, Orders, Products & Downloads

// ========== CHAT MANAGEMENT (NEW v7.0) ==========
async function loadChatsData(page = 1, status = 'all', priority = 'all') {
    const chatsPage = document.getElementById('chatsPage');
    
    chatsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Chat & Support Management</h1>
            <p class="page-subtitle">Monitor and manage customer support chats</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="chatStatusFilter">
                        <option value="all" ${status === 'all' ? 'selected' : ''}>All</option>
                        <option value="open" ${status === 'open' ? 'selected' : ''}>Open</option>
                        <option value="assigned" ${status === 'assigned' ? 'selected' : ''}>Assigned</option>
                        <option value="in-progress" ${status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                        <option value="resolved" ${status === 'resolved' ? 'selected' : ''}>Resolved</option>
                        <option value="closed" ${status === 'closed' ? 'selected' : ''}>Closed</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">Priority</label>
                    <select class="form-select" id="chatPriorityFilter">
                        <option value="all" ${priority === 'all' ? 'selected' : ''}>All</option>
                        <option value="low" ${priority === 'low' ? 'selected' : ''}>Low</option>
                        <option value="medium" ${priority === 'medium' ? 'selected' : ''}>Medium</option>
                        <option value="high" ${priority === 'high' ? 'selected' : ''}>High</option>
                        <option value="urgent" ${priority === 'urgent' ? 'selected' : ''}>Urgent</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="chatsContainer">
            <div style="text-align: center; padding: 40px;">
                <div class="spinner"></div>
                <p style="color: var(--gray); margin-top: 15px;">Loading chats...</p>
            </div>
        </div>
        <div class="pagination" id="chatsPagination"></div>
    `;
    
    document.getElementById('chatStatusFilter').addEventListener('change', (e) => {
        loadChatsData(1, e.target.value, document.getElementById('chatPriorityFilter').value);
    });
    
    document.getElementById('chatPriorityFilter').addEventListener('change', (e) => {
        loadChatsData(1, document.getElementById('chatStatusFilter').value, e.target.value);
    });
    
    try {
        const response = await fetch(`${API_URL}/api/agent/chats?page=${page}&limit=20&status=${status}&priority=${priority}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        const container = document.getElementById('chatsContainer');

        if (data.success) {
            if (data.chats.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí¨</div>
                        <h3>No Chats Found</h3>
                        <p>No chats match your filters</p>
                    </div>
                `;
            } else {
                container.innerHTML = data.chats.map(chat => `
                    <div class="chat-card" onclick="viewChatDetails('${chat.chatId}')">
                        <div class="chat-header">
                            <div class="chat-customer">
                                <div class="chat-avatar">üí¨</div>
                                <div class="chat-info">
                                    <h4>${chat.customerName}</h4>
                                    <p>${chat.subject}</p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="priority-badge priority-${chat.priority}">${chat.priority}</span>
                                <span class="status-badge status-${chat.status}">${chat.status}</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                            <div>
                                <small style="color: var(--gray);">
                                    ${chat.assignedAgent ? `Agent: ${chat.assignedAgent.fullName}` : 'Unassigned'}
                                    | ${chat.totalMessages} messages
                                    ${chat.unreadCount > 0 ? `| ${chat.unreadCount} unread` : ''}
                                </small>
                            </div>
                            <div class="action-btns">
                                ${!chat.assignedAgent ? `
                                    <button class="action-btn" onclick="event.stopPropagation(); openAssignChatModal('${chat.chatId}')" title="Assign Agent">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                ` : ''}
                                <button class="action-btn" onclick="event.stopPropagation(); viewChatDetails('${chat.chatId}')" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            if (data.pagination) {
                updatePagination('chatsPagination', data.pagination, (p) => loadChatsData(p, status, priority));
            }
        }
    } catch (error) {
        console.error('Chats error:', error);
        showNotification('Failed to load chats', 'error');
    }
}

async function openAssignChatModal(chatId) {
    try {
        const [chatRes, agentsRes] = await Promise.all([
            fetch(`${API_URL}/api/chat/${chatId}`),
            fetch(`${API_URL}/api/admin/agents`, { headers: { 'Authorization': `Bearer ${adminToken}` } })
        ]);

        const chatData = await chatRes.json();
        const agentsData = await agentsRes.json();

        if (chatData.success && agentsData.success) {
            document.getElementById('assignChatId').value = chatId;
            document.getElementById('assignChatDetails').innerHTML = `
                <strong>${chatData.chat.customerName}</strong><br>
                <small style="color: var(--gray);">${chatData.chat.subject}</small>
            `;

            const availableAgents = agentsData.agents.filter(a => 
                a.status === 'online' && a.activeChats < a.maxChats
            );

            const select = document.getElementById('assignAgentSelect');
            if (availableAgents.length === 0) {
                select.innerHTML = '<option value="">No available agents</option>';
            } else {
                select.innerHTML = availableAgents.map(agent => `
                    <option value="${agent.id}">
                        ${agent.name} (${agent.department}) - ${agent.activeChats}/${agent.maxChats} chats
                    </option>
                `).join('');
            }

            openModal('assignChatModal');
        }
    } catch (error) {
        showNotification('Failed to load chat assignment data', 'error');
    }
}

async function handleAssignChat(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/agent/chats/${formData.get('chatId')}/assign`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ agentId: formData.get('agentId') })
        });

        const data = await response.json();
        if (data.success) {
            showNotification('‚úÖ Chat assigned to agent!', 'success');
            closeModal('assignChatModal');
            loadChatsData();
        } else {
            showNotification(data.message, 'error');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to assign chat', 'error');
        hideLoading();
    }
}

async function viewChatDetails(chatId) {
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/chat/${chatId}`);
        const data = await response.json();

        if (data.success) {
            const chat = data.chat;
            document.getElementById('viewChatContent').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3>${chat.subject}</h3>
                    <p style="color: var(--gray);">
                        Customer: ${chat.customerName} (${chat.customerEmail})<br>
                        Status: <span class="status-badge status-${chat.status}">${chat.status}</span>
                        Priority: <span class="priority-badge priority-${chat.priority}">${chat.priority}</span>
                        ${chat.assignedAgent ? `<br>Agent: ${chat.assignedAgent.fullName}` : ''}
                    </p>
                </div>
                <div class="chat-messages">
                    ${chat.messages.map(msg => `
                        <div class="chat-message ${msg.sender}">
                            <div class="message-sender">${msg.senderName || msg.sender}</div>
                            <div class="message-text">${msg.message}</div>
                            <div class="message-time">${new Date(msg.timestamp).toLocaleString()}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            openModal('viewChatModal');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to load chat details', 'error');
        hideLoading();
    }
}

// ========== ORDERS MANAGEMENT ==========
async function loadOrdersData(page = 1, search = '', status = 'all') {
    const ordersPage = document.getElementById('ordersPage');
    
    ordersPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Orders Management</h1>
            <p class="page-subtitle">Track and manage all orders</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Search</label>
                    <input type="text" class="form-input" placeholder="Search..." id="orderSearchInput" value="${search}">
                </div>
                <div class="filter-item">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="orderStatusFilter">
                        <option value="all" ${status === 'all' ? 'selected' : ''}>All</option>
                        <option value="pending" ${status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="completed" ${status === 'completed' ? 'selected' : ''}>Completed</option>
                        <option value="failed" ${status === 'failed' ? 'selected' : ''}>Failed</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Order ID</th><th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Date</th><th>Actions</th></tr>
                </thead>
                <tbody id="ordersTable">
                    <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
            <div class="pagination" id="ordersPagination"></div>
        </div>
    `;
    
    document.getElementById('orderSearchInput').addEventListener('input', (e) => {
        loadOrdersData(1, e.target.value, document.getElementById('orderStatusFilter').value);
    });
    
    document.getElementById('orderStatusFilter').addEventListener('change', (e) => {
        loadOrdersData(1, document.getElementById('orderSearchInput').value, e.target.value);
    });
    
    try {
        const response = await fetch(`${API_URL}/api/admin/orders?page=${page}&limit=20&search=${search}&status=${status}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const tbody = document.getElementById('ordersTable');
            
            if (!data.orders || data.orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No orders found</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.orders.map(order => `
                <tr>
                    <td>${order.orderReference}</td>
                    <td>${order.customerInfo.name}<br><small style="color: var(--gray);">${order.customerInfo.email}</small></td>
                    <td>${order.items.length}</td>
                    <td>$${order.total.toFixed(2)}</td>
                    <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                    <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn" onclick="viewOrder('${order._id}')" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn danger" onclick="deleteOrder('${order._id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            if (data.pagination) {
                updatePagination('ordersPagination', data.pagination, (p) => loadOrdersData(p, search, status));
            }
        }
    } catch (error) {
        console.error('Orders error:', error);
        showNotification('Failed to load orders', 'error');
    }
}

async function viewOrder(orderId) {
    try {
        const response = await fetch(`${API_URL}/api/admin/orders/${orderId}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });
        const data = await response.json();
        
        if (data.success) {
            const order = data.order;
            const items = order.items.map(i => `- ${i.title}: $${i.price}`).join('\n');
            alert(`Order Details:\n\nID: ${order.orderReference}\nCustomer: ${order.customerInfo.name}\nEmail: ${order.customerInfo.email}\n\nItems:\n${items}\n\nSubtotal: $${order.subtotal.toFixed(2)}\nDiscount: $${order.discount.toFixed(2)}\nTotal: $${order.total.toFixed(2)}\n\nStatus: ${order.status}\nDate: ${new Date(order.createdAt).toLocaleString()}`);
        }
    } catch (error) {
        showNotification('Failed to load order', 'error');
    }
}

async function deleteOrder(orderId) {
    if (!confirm('Delete this order?')) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/orders/${orderId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Order deleted', 'success');
            loadOrdersData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to delete order', 'error');
    }
}

// ========== PRODUCTS MANAGEMENT ==========
async function loadProductsData(page = 1, search = '', status = 'all') {
    const productsPage = document.getElementById('productsPage');
    
    productsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Product Management</h1>
            <p class="page-subtitle">Manage products with download links</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Search</label>
                    <input type="text" class="form-input" placeholder="Search..." id="productSearchInput" value="${search}">
                </div>
                <div class="filter-item">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="productStatusFilter">
                        <option value="all" ${status === 'all' ? 'selected' : ''}>All</option>
                        <option value="active" ${status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="inactive" ${status === 'inactive' ? 'selected' : ''}>Inactive</option>
                    </select>
                </div>
                <div class="filter-item">
                    <button class="btn btn-primary" onclick="openModal('createProductModal')" style="margin-top: 24px;">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Product</th><th>Category</th><th>Price</th><th>Download</th><th>Stock</th><th>Status</th><th>Actions</th></tr>
                </thead>
                <tbody id="productsTable">
                    <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
            <div class="pagination" id="productsPagination"></div>
        </div>
    `;
    
    document.getElementById('productSearchInput').addEventListener('input', (e) => {
        loadProductsData(1, e.target.value, document.getElementById('productStatusFilter').value);
    });
    
    document.getElementById('productStatusFilter').addEventListener('change', (e) => {
        loadProductsData(1, document.getElementById('productSearchInput').value, e.target.value);
    });
    
    try {
        const response = await fetch(`${API_URL}/api/admin/products?page=${page}&limit=20&search=${search}&status=${status}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const tbody = document.getElementById('productsTable');
            
            if (!data.products || data.products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No products found</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.products.map(product => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5rem;">${product.icon || 'üì¶'}</span>
                            <div>${product.title}</div>
                        </div>
                    </td>
                    <td>${product.category}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>
                        ${product.downloadLink ? 
                            `<span class="download-indicator"><i class="fas fa-check-circle"></i> Active</span>` : 
                            `<span class="download-indicator no-download"><i class="fas fa-times-circle"></i> Missing</span>`
                        }
                    </td>
                    <td>${product.stock}</td>
                    <td><span class="status-badge ${product.isActive ? 'status-active' : 'status-inactive'}">${product.isActive ? 'Active' : 'Inactive'}</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn" onclick="editProduct('${product._id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn danger" onclick="deleteProduct('${product._id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            if (data.pagination) {
                updatePagination('productsPagination', data.pagination, (p) => loadProductsData(p, search, status));
            }
        }
    } catch (error) {
        console.error('Products error:', error);
        showNotification('Failed to load products', 'error');
    }
}

async function handleCreateProduct(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    const productData = {
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        price: parseFloat(formData.get('price')),
        comparePrice: formData.get('comparePrice') ? parseFloat(formData.get('comparePrice')) : 0,
        downloadLink: formData.get('downloadLink') || '',
        fileSize: formData.get('fileSize') || '',
        version: formData.get('version') || '',
        icon: formData.get('icon') || 'üì¶',
        isActive: formData.get('isActive') === 'on',
        isFeatured: formData.get('isFeatured') === 'on'
    };
    
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/admin/products`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(productData)
        });

        const data = await response.json();
        if (data.success) {
            showNotification('‚úÖ Product created!', 'success');
            closeModal('createProductModal');
            event.target.reset();
            loadProductsData();
        } else {
            showNotification(data.message, 'error');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to create product', 'error');
        hideLoading();
    }
}

async function editProduct(productId) {
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/products/${productId}`);
        const data = await response.json();
        
        if (data.success) {
            const product = data.product;
            document.getElementById('editProductId').value = product._id;
            document.getElementById('editProductTitle').value = product.title;
            document.getElementById('editProductDescription').value = product.description;
            document.getElementById('editProductCategory').value = product.category;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductDownloadLink').value = product.downloadLink || '';
            document.getElementById('editProductFileSize').value = product.fileSize || '';
            document.getElementById('editProductIsActive').checked = product.isActive;
            document.getElementById('editProductIsFeatured').checked = product.isFeatured;
            openModal('editProductModal');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to load product', 'error');
        hideLoading();
    }
}

async function handleUpdateProduct(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const productId = formData.get('productId');
    
    const productData = {
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        price: parseFloat(formData.get('price')),
        downloadLink: formData.get('downloadLink') || '',
        fileSize: formData.get('fileSize') || '',
        isActive: formData.get('isActive') === 'on',
        isFeatured: formData.get('isFeatured') === 'on'
    };
    
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/admin/products/${productId}`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(productData)
        });

        const data = await response.json();
        if (data.success) {
            showNotification('‚úÖ Product updated!', 'success');
            closeModal('editProductModal');
            loadProductsData();
        } else {
            showNotification(data.message, 'error');
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to update product', 'error');
        hideLoading();
    }
}

async function deleteProduct(productId) {
    if (!confirm('Delete this product?')) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/products/${productId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Product deleted', 'success');
            loadProductsData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to delete product', 'error');
    }
}

// ========== DOWNLOADS ==========
async function loadDownloadsData() {
    const downloadsPage = document.getElementById('downloadsPage');
    
    downloadsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Download Management</h1>
            <p class="page-subtitle">Track product downloads and statistics</p>
        </div>
        <div class="metrics-grid" id="downloadMetrics">
            <div class="metric-item">
                <div class="metric-value">...</div>
                <div class="metric-label">Loading...</div>
            </div>
        </div>
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Most Downloaded Products</h3>
            </div>
            <table>
                <thead>
                    <tr><th>Product</th><th>Category</th><th>Downloads</th></tr>
                </thead>
                <tbody id="popularProductsTable">
                    <tr><td colspan="3" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    `;
    
    try {
        showLoading();
        const response = await fetch(`${API_URL}/api/admin/downloads/stats`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const { totalDownloads, popularProducts, downloadsByDate } = data.stats;
            const recentCount = downloadsByDate.slice(-7).reduce((sum, day) => sum + day.count, 0);
            
            document.getElementById('downloadMetrics').innerHTML = `
                <div class="metric-item">
                    <div class="metric-value">${totalDownloads}</div>
                    <div class="metric-label">Total Downloads</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${recentCount}</div>
                    <div class="metric-label">Last 7 Days</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${popularProducts.length}</div>
                    <div class="metric-label">Products Downloaded</div>
                </div>
            `;
            
            const table = document.getElementById('popularProductsTable');
            if (popularProducts.length > 0) {
                table.innerHTML = popularProducts.map(item => `
                    <tr>
                        <td>${item.product?.title || 'Unknown'}</td>
                        <td>${item.product?.category || 'N/A'}</td>
                        <td><strong style="color: var(--primary);">${item.count}</strong></td>
                    </tr>
                `).join('');
            } else {
                table.innerHTML = '<tr><td colspan="3" style="text-align: center;">No data</td></tr>';
            }
        }
        hideLoading();
    } catch (error) {
        showNotification('Failed to load downloads', 'error');
        hideLoading();
    }
}

console.log('‚úÖ Part 4/5 loaded: Chats, Orders, Products & Downloads');
// ========== ADMIN DASHBOARD v7.0 - JAVASCRIPT PART 5 OF 5 (FINAL) ==========
// Coupons, Blog & System Settings

// ========== COUPONS MANAGEMENT ==========
async function loadCouponsData(status = 'all') {
    const couponsPage = document.getElementById('couponsPage');
    
    couponsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Coupon Management</h1>
            <p class="page-subtitle">Create and manage discount coupons</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="couponStatusFilter">
                        <option value="all" ${status === 'all' ? 'selected' : ''}>All</option>
                        <option value="active" ${status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="inactive" ${status === 'inactive' ? 'selected' : ''}>Inactive</option>
                    </select>
                </div>
                <div class="filter-item">
                    <button class="btn btn-primary" onclick="openModal('createCouponModal')" style="margin-top: 24px;">
                        <i class="fas fa-plus"></i> Create Coupon
                    </button>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Code</th><th>Discount</th><th>Type</th><th>Usage</th><th>Min. Purchase</th><th>Status</th><th>Actions</th></tr>
                </thead>
                <tbody id="couponsTable">
                    <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    `;
    
    document.getElementById('couponStatusFilter').addEventListener('change', (e) => {
        loadCouponsData(e.target.value);
    });
    
    try {
        const response = await fetch(`${API_URL}/api/admin/coupons?status=${status}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const tbody = document.getElementById('couponsTable');
            
            if (!data.coupons || data.coupons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No coupons found</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.coupons.map(coupon => `
                <tr>
                    <td><strong>${coupon.code}</strong></td>
                    <td>${coupon.discount}${coupon.type === 'percentage' ? '%' : '$'}</td>
                    <td>${coupon.type}</td>
                    <td>${coupon.usageCount}${coupon.usageLimit ? `/${coupon.usageLimit}` : ''}</td>
                    <td>$${coupon.minPurchaseAmount}</td>
                    <td><span class="status-badge ${coupon.isActive ? 'status-active' : 'status-inactive'}">${coupon.isActive ? 'Active' : 'Inactive'}</span></td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn" onclick="toggleCouponStatus('${coupon.code}', ${!coupon.isActive})" title="${coupon.isActive ? 'Deactivate' : 'Activate'}">
                                <i class="fas fa-toggle-${coupon.isActive ? 'on' : 'off'}"></i>
                            </button>
                            <button class="action-btn danger" onclick="deleteCoupon('${coupon.code}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
    } catch (error) {
        console.error('Coupons error:', error);
        showNotification('Failed to load coupons', 'error');
    }
}

async function handleCreateCoupon(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    const couponData = {
        code: formData.get('code').toUpperCase(),
        discount: parseFloat(formData.get('discount')),
        type: formData.get('type'),
        minPurchaseAmount: parseFloat(formData.get('minPurchaseAmount')) || 0
    };
    
    if (formData.get('usageLimit')) {
        couponData.usageLimit = parseInt(formData.get('usageLimit'));
    }
    
    try {
        const response = await fetch(`${API_URL}/api/admin/coupons`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(couponData)
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Coupon created successfully', 'success');
            closeModal('createCouponModal');
            event.target.reset();
            loadCouponsData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to create coupon', 'error');
    }
}

async function toggleCouponStatus(code, isActive) {
    try {
        const response = await fetch(`${API_URL}/api/admin/coupons/${code}`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ isActive })
        });

        const data = await response.json();
        if (data.success) {
            showNotification(`Coupon ${isActive ? 'activated' : 'deactivated'}`, 'success');
            loadCouponsData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to update coupon', 'error');
    }
}

async function deleteCoupon(code) {
    if (!confirm(`Delete coupon "${code}"?`)) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/coupons/${code}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Coupon deleted', 'success');
            loadCouponsData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to delete coupon', 'error');
    }
}

// ========== BLOG MANAGEMENT ==========
async function loadBlogData(status = 'all') {
    const blogPage = document.getElementById('blogPage');
    
    blogPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">Blog Management</h1>
            <p class="page-subtitle">Create and manage blog posts</p>
        </div>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="blogStatusFilter">
                        <option value="all" ${status === 'all' ? 'selected' : ''}>All</option>
                        <option value="published" ${status === 'published' ? 'selected' : ''}>Published</option>
                        <option value="draft" ${status === 'draft' ? 'selected' : ''}>Draft</option>
                        <option value="archived" ${status === 'archived' ? 'selected' : ''}>Archived</option>
                    </select>
                </div>
                <div class="filter-item">
                    <button class="btn btn-primary" onclick="openModal('createBlogModal')" style="margin-top: 24px;">
                        <i class="fas fa-plus"></i> Create Post
                    </button>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Title</th><th>Category</th><th>Status</th><th>Views</th><th>Date</th><th>Actions</th></tr>
                </thead>
                <tbody id="blogTable">
                    <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    `;
    
    document.getElementById('blogStatusFilter').addEventListener('change', (e) => {
        loadBlogData(e.target.value);
    });
    
    try {
        const response = await fetch(`${API_URL}/api/admin/blog/posts?status=${status}`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success) {
            const tbody = document.getElementById('blogTable');
            
            if (!data.posts || data.posts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No posts found</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.posts.map(post => `
                <tr>
                    <td>${post.title}</td>
                    <td>${post.category}</td>
                    <td><span class="status-badge status-${post.status}">${post.status}</span></td>
                    <td>${post.views}</td>
                    <td>${new Date(post.createdAt).toLocaleDateString()}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn" onclick="toggleBlogStatus('${post._id}', '${post.status}')" title="Change Status">
                                <i class="fas fa-sync"></i>
                            </button>
                            <button class="action-btn danger" onclick="deleteBlogPost('${post._id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
    } catch (error) {
        console.error('Blog error:', error);
        showNotification('Failed to load blog posts', 'error');
    }
}

async function handleCreateBlogPost(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    
    const postData = {
        title: formData.get('title'),
        excerpt: formData.get('excerpt'),
        content: formData.get('content'),
        category: formData.get('category'),
        status: formData.get('status')
    };
    
    try {
        const response = await fetch(`${API_URL}/api/admin/blog/posts`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(postData)
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Blog post created', 'success');
            closeModal('createBlogModal');
            event.target.reset();
            loadBlogData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to create post', 'error');
    }
}

async function toggleBlogStatus(postId, currentStatus) {
    const statuses = ['draft', 'published', 'archived'];
    const currentIndex = statuses.indexOf(currentStatus);
    const nextStatus = statuses[(currentIndex + 1) % statuses.length];
    
    if (!confirm(`Change status to "${nextStatus}"?`)) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/blog/posts/${postId}`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ status: nextStatus })
        });

        const data = await response.json();
        if (data.success) {
            showNotification(`Status updated to ${nextStatus}`, 'success');
            loadBlogData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to update status', 'error');
    }
}

async function deleteBlogPost(postId) {
    if (!confirm('Delete this post?')) return;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/blog/posts/${postId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Post deleted', 'success');
            loadBlogData();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to delete post', 'error');
    }
}

// ========== SYSTEM SETTINGS ==========
async function loadSettingsData() {
    const settingsPage = document.getElementById('settingsPage');
    
    settingsPage.innerHTML = `
        <div class="page-header">
            <h1 class="page-title">System Settings</h1>
            <p class="page-subtitle">Configure system preferences</p>
        </div>
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">General Settings</h3>
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
            <form id="settingsForm">
                <div class="form-group">
                    <label class="form-label">Site Name</label>
                    <input type="text" class="form-input" name="siteName" id="siteName" placeholder="UYEH TECH">
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Email</label>
                    <input type="email" class="form-input" name="contactEmail" id="contactEmail" placeholder="contact@uyehtech.com">
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="allowRegistration" id="allowRegistration"> Allow User Registration
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="maintenanceMode" id="maintenanceMode"> Maintenance Mode
                    </label>
                </div>
            </form>
        </div>
        <div class="info-card" style="margin-top: 30px;">
            <div class="info-card-header">
                <div class="info-card-icon">‚ÑπÔ∏è</div>
                <div class="info-card-title">System Information</div>
            </div>
            <div class="info-card-content">
                <strong>Version:</strong> 7.0.0<br>
                <strong>Features:</strong> Complete Admin System with Agent Management & Real-time Chat<br>
                <strong>Status:</strong> <span style="color: var(--success);">‚úÖ All Systems Operational</span>
            </div>
        </div>
    `;
    
    try {
        const response = await fetch(`${API_URL}/api/admin/settings`, {
            headers: { 'Authorization': `Bearer ${adminToken}` }
        });

        const data = await response.json();

        if (data.success && data.settings) {
            const settings = data.settings;
            document.getElementById('siteName').value = settings.siteName || '';
            document.getElementById('contactEmail').value = settings.contactEmail || '';
            document.getElementById('allowRegistration').checked = settings.allowRegistration !== false;
            document.getElementById('maintenanceMode').checked = settings.maintenanceMode || false;
        }
    } catch (error) {
        console.error('Settings error:', error);
        showNotification('Failed to load settings', 'error');
    }
}

async function saveSettings() {
    const form = document.getElementById('settingsForm');
    const formData = new FormData(form);
    
    const settingsData = {
        siteName: formData.get('siteName'),
        contactEmail: formData.get('contactEmail'),
        allowRegistration: formData.get('allowRegistration') === 'on',
        maintenanceMode: formData.get('maintenanceMode') === 'on'
    };
    
    try {
        const response = await fetch(`${API_URL}/api/admin/settings`, {
            method: 'PUT',
            headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(settingsData)
        });

        const data = await response.json();
        if (data.success) {
            showNotification('Settings saved successfully', 'success');
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('Failed to save settings', 'error');
    }
}

console.log('‚úÖ Part 5/5 loaded: Coupons, Blog & Settings');
console.log('üéâ Admin Dashboard v7.0 - COMPLETE! All 5 parts loaded successfully!');
console.log('üìã Summary:');
console.log('  ‚úÖ Part 1: Core, Auth, Navigation & Utilities');
console.log('  ‚úÖ Part 2: Dashboard & Analytics');
console.log('  ‚úÖ Part 3: Users & Agent Management');
console.log('  ‚úÖ Part 4: Chats, Orders, Products & Downloads');
console.log('  ‚úÖ Part 5: Coupons, Blog & Settings');
console.log('üöÄ Ready for production!');
    </script>
</body>
</html>